<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>server&#x2F;lib&#x2F;skill-service.js - Eve Ship Comparator API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Eve Ship Comparator API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/esc.CompareView.html">esc.CompareView</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Capacitor.html">esc.model.Capacitor</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Capacity.html">esc.model.Capacity</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.DamageProfile.html">esc.model.DamageProfile</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Drones.html">esc.model.Drones</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Heat.html">esc.model.Heat</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.HpPool.html">esc.model.HpPool</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.JumpDrive.html">esc.model.JumpDrive</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Sensors.html">esc.model.Sensors</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Shield.html">esc.model.Shield</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Ship.html">esc.model.Ship</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Skill.html">esc.model.Skill</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.SkillRequirement.html">esc.model.SkillRequirement</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.SkillRequirements.html">esc.model.SkillRequirements</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Slots.html">esc.model.Slots</a></li>
            
                <li><a href="..&#x2F;classes/esc.service.ShipService.html">esc.service.ShipService</a></li>
            
                <li><a href="..&#x2F;classes/esc.service.SkillService.html">esc.service.SkillService</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Criteria.html">esc.util.Criteria</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Database.html">esc.util.Database</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.MicroTemplate.html">esc.util.MicroTemplate</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Promise.html">esc.util.Promise</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Promise.Resolver.html">esc.util.Promise.Resolver</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Query.html">esc.util.Query</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Select.html">esc.util.Select</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/esc-compare-view.html">esc-compare-view</a></li>
            
                <li><a href="..&#x2F;modules/esc-hp-pool.html">esc-hp-pool</a></li>
            
                <li><a href="..&#x2F;modules/esc-micro-template.html">esc-micro-template</a></li>
            
                <li><a href="..&#x2F;modules/esc-promise.html">esc-promise</a></li>
            
                <li><a href="..&#x2F;modules/esc-select.html">esc-select</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship.html">esc-ship</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship-properties.html">esc-ship-properties</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship-service.html">esc-ship-service</a></li>
            
                <li><a href="..&#x2F;modules/esc-skill.html">esc-skill</a></li>
            
                <li><a href="..&#x2F;modules/esc-skill-service.html">esc-skill-service</a></li>
            
                <li><a href="..&#x2F;modules/esc-sqlite.html">esc-sqlite</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: server&#x2F;lib&#x2F;skill-service.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global YUI*&#x2F;
&#x2F;**
 @module esc-skill-service
 @namespace esc.service
 *&#x2F;
YUI.add(&#x27;esc-skill-service&#x27;, function (Y) {
    &quot;use strict&quot;;

    var NS = Y.namespace(&#x27;esc.service&#x27;),
        Skill = Y.esc.model.Skill,
        SkillRequirement = Y.esc.model.SkillRequirement,
        Promise = Y.esc.util.Promise,

        xml2js = YUI.require(&#x27;xml2js&#x27;),
        https = YUI.require(&#x27;https&#x27;);

    &#x2F;**
     @class SkillService
     @constructor
     @extends esc.util.Promise
     @example

         SkillService.retrieve(&#x27;https:&#x2F;&#x2F;api.eveonline.com&#x2F;eve&#x2F;SkillTree.xml.aspx&#x27;).getSkill(12345).then(function(s) {
            console.log(s.name);
         });
     **&#x2F;
    function SkillService(resolver) {
        SkillService.superclass.constructor.apply(this, arguments);
    }

    &#x2F;**
     @method retrieve
     @static
     @param url {String}
     @return {esc.service.SkillService}
     *&#x2F;
    SkillService.retrieve = function (url) {
        return new SkillService(function (fulfill, reject) {
            var data = &#x27;&#x27;;

            https.get(url,function (res) {
                res.on(&#x27;data&#x27;, function (d) {
                    data += d;
                });

                res.on(&#x27;end&#x27;, function () {
                    var parser = new xml2js.Parser(),
                        skillTree = {};

                    parser.parseString(data, function (err, result) {
                        var groups = result.eveapi.result[0].rowset[0].row,
                            group, i, l,
                            skills, skill, ii, ll;

                        for (i = 0, l = groups.length; i &lt; l; i += 1) {
                            group = groups[i];
                            skills = group.rowset[0].row;

                            for (ii = 0, ll = skills.length; ii &lt; ll; ii += 1) {
                                skill = skills[ii];

                                if (skill.$.published === &#x27;1&#x27;) {

                                    skillTree[skill.$.typeID] = new Skill({
                                        id           : parseFloat(skill.$.typeID),
                                        name         : skill.$.typeName,
                                        group        : group.$.groupName,
                                        description  : skill.description[0],
                                        rank         : parseFloat(skill.rank[0]),
                                        requirements : skill.rowset[0].row ? skill.rowset[0].row.map(function (s) {
                                            return new SkillRequirement({
                                                id    : parseFloat(s.$.typeID),
                                                level : parseFloat(s.$.skillLevel)
                                            });

                                        }) : []
                                    });

                                }
                            }
                        }

                        fulfill(skillTree);
                    });
                });
            }).on(&#x27;error&#x27;, function (e) {
                    reject(e);
                });

        });
    };

    &#x2F;**
     @method resolveSkillsFromTree
     @static
     @param ids {Array|Number} A list of ids
     @param tree {Object} The skill tree to pull the ids out of.
     @return {Object} Skills
     *&#x2F;
    SkillService.resolveSkillsFromTree = function (ids, tree) {
        ids = Array.isArray(ids) ? ids : [ ids ];

        var i, l, ii, iii, ll, lll, skills = [], skill, reqs;

        for (i = 0, l = ids.length; i &lt; l; i += 1) {
            skill = tree[ids[i]];

            if (skill &amp;&amp; skill.requirements &amp;&amp; skill.requirements.length) {
                reqs = SkillService.resolveSkillsFromTree(skill.requirements.map(function (i) {
                    return i.id;
                }), tree);

                for (ii = 0, ll = reqs.length; ii &lt; ll; ii += 1) {
                    for (iii = 0, lll = skill.requirements.length; iii &lt; lll; iii += 1) {
                        if (reqs[ii].id === skill.requirements[iii].id) {
                            skill.requirements[iii].skill = reqs[ii];
                        }
                    }
                }
            }

            skills.push(skill);
        }

        return skills;
    };

    Y.extend(SkillService, Promise, {
        &#x2F;**
         @method getSkill
         @params ids {Number|Number[]} A single id or list of ids to resolve.
         @return {Skill[]}
        **&#x2F;
        getSkill : function (ids) {
            return this.then(function (tree) {
                var res = SkillService.resolveSkillsFromTree(ids, tree);

                return res.length === 1 ? res[0] : res;
            });
        }
    });

    NS.SkillService = SkillService;

}, &#x27;&#x27;, {
    requires : [ &#x27;esc-promise&#x27; ]
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
