<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>server&#x2F;lib&#x2F;select.js - Eve Ship Comparator API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Eve Ship Comparator API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/esc.Capacitor.html">esc.Capacitor</a></li>
            
                <li><a href="..&#x2F;classes/esc.Capacity.html">esc.Capacity</a></li>
            
                <li><a href="..&#x2F;classes/esc.Criteria.html">esc.Criteria</a></li>
            
                <li><a href="..&#x2F;classes/esc.DamageProfile.html">esc.DamageProfile</a></li>
            
                <li><a href="..&#x2F;classes/esc.Database.html">esc.Database</a></li>
            
                <li><a href="..&#x2F;classes/esc.Drones.html">esc.Drones</a></li>
            
                <li><a href="..&#x2F;classes/esc.Heat.html">esc.Heat</a></li>
            
                <li><a href="..&#x2F;classes/esc.HpPool.html">esc.HpPool</a></li>
            
                <li><a href="..&#x2F;classes/esc.JumpDrive.html">esc.JumpDrive</a></li>
            
                <li><a href="..&#x2F;classes/esc.MicroTemplate.html">esc.MicroTemplate</a></li>
            
                <li><a href="..&#x2F;classes/esc.Promise.html">esc.Promise</a></li>
            
                <li><a href="..&#x2F;classes/esc.Promise.Resolver.html">esc.Promise.Resolver</a></li>
            
                <li><a href="..&#x2F;classes/esc.Query.html">esc.Query</a></li>
            
                <li><a href="..&#x2F;classes/esc.Select.html">esc.Select</a></li>
            
                <li><a href="..&#x2F;classes/esc.Sensors.html">esc.Sensors</a></li>
            
                <li><a href="..&#x2F;classes/esc.Shield.html">esc.Shield</a></li>
            
                <li><a href="..&#x2F;classes/esc.Ship.html">esc.Ship</a></li>
            
                <li><a href="..&#x2F;classes/esc.Skill.html">esc.Skill</a></li>
            
                <li><a href="..&#x2F;classes/esc.SkillRequirement.html">esc.SkillRequirement</a></li>
            
                <li><a href="..&#x2F;classes/esc.SkillRequirements.html">esc.SkillRequirements</a></li>
            
                <li><a href="..&#x2F;classes/esc.Slots.html">esc.Slots</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/esc-hp-pool.html">esc-hp-pool</a></li>
            
                <li><a href="..&#x2F;modules/esc-micro-template.html">esc-micro-template</a></li>
            
                <li><a href="..&#x2F;modules/esc-promise.html">esc-promise</a></li>
            
                <li><a href="..&#x2F;modules/esc-select.html">esc-select</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship.html">esc-ship</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship-properties.html">esc-ship-properties</a></li>
            
                <li><a href="..&#x2F;modules/esc-skill.html">esc-skill</a></li>
            
                <li><a href="..&#x2F;modules/esc-sqlite.html">esc-sqlite</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: server&#x2F;lib&#x2F;select.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global YUI*&#x2F;
&#x2F;**
 A tool to make it easier to build complex SQL queries.

 @module esc-select
 @namespace esc
 **&#x2F;
YUI.add(&#x27;esc-select&#x27;, function (Y) {
    &quot;use strict&quot;;

    var NS = Y.namespace(&#x27;esc&#x27;);

    &#x2F;**
     @class Criteria
     @constructor
     **&#x2F;
    function Criteria(criteria, parentCriteria, selectStatement) {
        if (!this instanceof Criteria) {
            return new Criteria(criteria, parentCriteria, selectStatement);
        }

        this.parent = parentCriteria;
        this.parentSelect = selectStatement;

        if (criteria instanceof Criteria) {
            criteria.parent = this;
            criteria.select = this.parentSelect;

            this.criteria = criteria;
        } else if (typeof criteria === &#x27;string&#x27;) {
            this.criteria = { column : criteria };
        } else if (typeof criteria === &#x27;function&#x27;) {
            this.criteria = criteria;
        }
    }

    Y.mix(Criteria.prototype, {
        &#x2F;**
         The parent criteria for this instance.

         @property parent {esc.Criteria}
         *&#x2F;
        parent : null,

        &#x2F;**
         The child criteria for this instance.

         @property child {esc.Criteria}
         *&#x2F;
        child : null,

        &#x2F;**
         The parent select statement.

         @property parentSelect {esc.Select}
         *&#x2F;
        parentSelect : null,

        &#x2F;**
         Returns the select statement that this criteria is a part of, if one exists. If this Critiera doesn&#x27;t know what select statement it is a part of, it will traverse the criteria tree until it finds it.

         @method select
         @returns {esc.Select} The parent select object, if any.
         *&#x2F;
        select : function () {
            var out, p;
            if (this.parentSelect) {
                out = this.parentSelect;
            } else {
                p = this.parent;

                while (p.parent) {
                    p = p.parent;
                }

                if (p.select) {
                    out = p.select;
                } else {
                    out = null;
                }
            }
            return out;
        },

        addChildCriteria : function (join, columnOrCriteria) {
            var childCriteria = new Criteria(columnOrCriteria, this, this.parentSelect);

            this.child = { criteria : childCriteria, join : join };

            return childCriteria;
        },

        and : function (columnOrCriteria) {
            return this.addChildCriteria(&#x27;AND&#x27;, columnOrCriteria);
        },
        or  : function (columnOrCriteria) {
            return this.addChildCriteria(&#x27;OR&#x27;, columnOrCriteria);
        },

        addPredicate : function (join, value) {
            var criteria = this.criteria;

            if (criteria instanceof Criteria) {
                throw &quot;Can&#x27;t add predicate to Criteria instance.&quot;;
            }

            criteria.value = value;
            criteria.join = join;

            return this;
        },

        like : function (value) {
            value = value.replace(&#x2F;(\&#x27;)&#x2F;g, &#x27;\\$1&#x27;);

            return this.addPredicate(&#x27;LIKE&#x27;, &quot;&#x27;&quot; + value + &quot;&#x27; ESCAPE &#x27;\\&#x27;&quot;);
        },
        is   : function (value) {
            return this.addPredicate(&#x27;==&#x27;, value);
        },
        gt   : function (value) {
            return this.addPredicate(&#x27;&gt;&#x27;, value);
        },
        lt   : function (value) {
            return this.addPredicate(&#x27;&lt;&#x27;, value);
        },

        orderBy : function () {
            var sel = this.select();
            return sel.orderBy.apply(sel, arguments);
        },
        limit   : function () {
            var sel = this.select();
            return sel.limit.apply(sel, arguments);
        },

        exec : function (a, force) {
            var criteria = this.criteria,
                sel,
                out;

            if (force) {
                if (criteria instanceof Criteria) {
                    out = [ &#x27;(&#x27;, criteria.exec(a, true), &#x27;)&#x27; ].join(&#x27; &#x27;);
                } else if (typeof criteria === &#x27;function&#x27;) {
                    out = criteria.call(this, a);
                } else {
                    out = [ criteria.column, criteria.join, Y.Lang.sub(criteria.value, a) ].join(&#x27; &#x27;);
                }

                if (this.child) {
                    out = [ out, this.child.join, this.child.criteria.exec(a, true) ].join(&#x27; &#x27;);
                }

            } else {
                sel = this.select();
                out = sel.exec.apply(sel, arguments);
            }

            return out;
        }
    });

    NS.Criteria = Criteria;

    &#x2F;**
     @class Select
     @constructor
     *&#x2F;
    function Select(tablesAndFields) {
        var table, fields, field, i, l;

        this.tables = {};
        this.fields = {};

        for (table in tablesAndFields) {
            if (tablesAndFields.hasOwnProperty(table)) {
                fields = tablesAndFields[table];

                this.tables[table] = true;

                if ((&#x2F;\s+AS\s+&#x2F;).test(table)) {
                    table = (&#x2F;\s+AS\s+([\w\W]+)&#x2F;).exec(table)[1];
                }

                for (i = 0, l = fields.length; i &lt; l; i += 1) {
                    field = fields[i];

                    this.fields[table + &#x27;.&#x27; + field] = true;
                }
            }
        }

        this.tables = Object.keys(this.tables);
        this.fields = Object.keys(this.fields);
    }

    Select.from = function (tablesAndFields) {
        return new Select(tablesAndFields);
    };

    Y.mix(Select.prototype, {
        tables   : null,
        fields   : null,
        criteria : null,

        where : function (columnOrCriteria) {
            var c = new Criteria(columnOrCriteria, null, this);

            this.criteria = c;
            return c;
        },

        limit : function () {

            return this;
        },

        orderBy : function () {

            return this;
        },

        exec : function (a) {
            var sel = [
                &#x27;SELECT&#x27;, this.fields.join(&#x27;, &#x27;),
                &#x27;FROM&#x27;, this.tables.join(&#x27;, &#x27;)
            ];

            if (this.criteria) {
                sel.push(&#x27;WHERE&#x27;);
                sel.push(this.criteria.exec(a, true));
            }

            return sel.join(&#x27; &#x27;);
        }
    });

    NS.Select = Select;

}, &#x27;&#x27;, {});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
