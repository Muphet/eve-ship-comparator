<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>server&#x2F;lib&#x2F;select.js - Eve Ship Comparator API</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Eve Ship Comparator API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/esc.CompareView.html">esc.CompareView</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Capacitor.html">esc.model.Capacitor</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Capacity.html">esc.model.Capacity</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.DamageProfile.html">esc.model.DamageProfile</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Drones.html">esc.model.Drones</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Heat.html">esc.model.Heat</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.HpPool.html">esc.model.HpPool</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.JumpDrive.html">esc.model.JumpDrive</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Sensors.html">esc.model.Sensors</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Shield.html">esc.model.Shield</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Ship.html">esc.model.Ship</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Skill.html">esc.model.Skill</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.SkillRequirement.html">esc.model.SkillRequirement</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.SkillRequirements.html">esc.model.SkillRequirements</a></li>
            
                <li><a href="..&#x2F;classes/esc.model.Slots.html">esc.model.Slots</a></li>
            
                <li><a href="..&#x2F;classes/esc.service.ShipService.html">esc.service.ShipService</a></li>
            
                <li><a href="..&#x2F;classes/esc.service.SkillService.html">esc.service.SkillService</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Criteria.html">esc.util.Criteria</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Database.html">esc.util.Database</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.MicroTemplate.html">esc.util.MicroTemplate</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Promise.html">esc.util.Promise</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Promise.Resolver.html">esc.util.Promise.Resolver</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Query.html">esc.util.Query</a></li>
            
                <li><a href="..&#x2F;classes/esc.util.Select.html">esc.util.Select</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/esc-compare-view.html">esc-compare-view</a></li>
            
                <li><a href="..&#x2F;modules/esc-hp-pool.html">esc-hp-pool</a></li>
            
                <li><a href="..&#x2F;modules/esc-micro-template.html">esc-micro-template</a></li>
            
                <li><a href="..&#x2F;modules/esc-promise.html">esc-promise</a></li>
            
                <li><a href="..&#x2F;modules/esc-select.html">esc-select</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship.html">esc-ship</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship-properties.html">esc-ship-properties</a></li>
            
                <li><a href="..&#x2F;modules/esc-ship-service.html">esc-ship-service</a></li>
            
                <li><a href="..&#x2F;modules/esc-skill.html">esc-skill</a></li>
            
                <li><a href="..&#x2F;modules/esc-skill-service.html">esc-skill-service</a></li>
            
                <li><a href="..&#x2F;modules/esc-sqlite.html">esc-sqlite</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: server&#x2F;lib&#x2F;select.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*global YUI*&#x2F;
&#x2F;**
 A tool to make it easier to build complex SQL queries.

 @module esc-select
 @namespace esc.util
 **&#x2F;
YUI.add(&#x27;esc-select&#x27;, function (Y) {
    &quot;use strict&quot;;

    var NS = Y.namespace(&#x27;esc.util&#x27;);

    &#x2F;**

     A criteria object generates a set of conditionals to be attached to a SQL query. Criteria objects are usually generated from Select instances using the &#x60;where&#x60; method, but can be generated on its own, if that level of control is needed.

     @class Criteria
     @constructor
     @param criteria {String|Function|esc.Criteria}

     If the &#x60;criteria&#x60; argument is a string, it sets the column the criteria is looking at, so that it can be followed by a call to &#x60;is&#x60;, &#x60;gt&#x60;, &#x60;lt&#x60;, or &#x60;like&#x60;. If the criteria argument is a function, it will evaluate the function against provided arguments when the criteria is evaluated. If the criteria is a &#x60;Criteria&#x60; instance, it attaches that. This last case is useful for attaching tree-based criteria to a query.

     @param [parentCriteria] {Criteria} Criteria objects exist in a linked list. If the parentCriteria is defined, it will be set as the previous link in the list.
     @param [selectStatement] {Select} The containing select statement.
     **&#x2F;
    function Criteria(criteria, parentCriteria, selectStatement) {
        if (!this instanceof Criteria) {
            return new Criteria(criteria, parentCriteria, selectStatement);
        }

        this.parent = parentCriteria;
        this.parentSelect = selectStatement;

        if (criteria instanceof Criteria) {
            criteria.parent = this;
            criteria.select = this.parentSelect;

            this.criteria = criteria;
        } else if (typeof criteria === &#x27;string&#x27;) {
            this.criteria = { column : criteria };
        } else if (typeof criteria === &#x27;function&#x27;) {
            this.criteria = criteria;
        }
    }

    Y.mix(Criteria.prototype, {
        &#x2F;**
         The parent criteria for this instance.

         @property parent {esc.Criteria}
         *&#x2F;
        parent : null,

        &#x2F;**
         The child criteria for this instance.

         @property child {esc.Criteria}
         *&#x2F;
        child : null,

        &#x2F;**
         The parent select statement.

         @property parentSelect {esc.Select}
         *&#x2F;
        parentSelect : null,

        &#x2F;**
         Returns the select statement that this criteria is a part of, if one exists. If this Critiera doesn&#x27;t know what select statement it is a part of, it will traverse the criteria tree until it finds it.

         @method select
         @returns {esc.Select} The parent select object, if any.
         *&#x2F;
        select : function () {
            var out, p;
            if (this.parentSelect) {
                out = this.parentSelect;
            } else {
                p = this.parent;

                while (p.parent) {
                    p = p.parent;
                }

                if (p.select) {
                    out = p.select;
                } else {
                    out = null;
                }
            }
            return out;
        },

        &#x2F;**
         Adds a child criteria to the linked list and returns it. Used for fluent chaining.

         @method addChildCriteria
         @protected
         @param join {String}
         @param columnOrCriteria {String|Function|Criteria}
         @return {esc.Criteria} The child criteria.
         **&#x2F;
        addChildCriteria : function (join, columnOrCriteria) {
            var childCriteria = new Criteria(columnOrCriteria, this, this.parentSelect);

            this.child = { criteria : childCriteria, join : join };

            return childCriteria;
        },

        &#x2F;**
         Adds a new &#x60;AND&#x60; child criteria and returns it.

         @method and
         @param columnOrCriteria {String|Function|Criteria}
         @return {esc.Criteria} The child criteria
         **&#x2F;
        and : function (columnOrCriteria) {
            return this.addChildCriteria(&#x27;AND&#x27;, columnOrCriteria);
        },

        &#x2F;**
         Adds a new &#x60;OR&#x60; child criteria and returns it.

         @method or
         @param columnOrCriteria {String|Function|Criteria}
         @return {esc.Criteria} The child criteria
         **&#x2F;
        or : function (columnOrCriteria) {
            return this.addChildCriteria(&#x27;OR&#x27;, columnOrCriteria);
        },

        &#x2F;**
         Adds a predicate to the current criteria.

         @method addPredicate
         @protected
         @chainable
         @param join {String}
         @param value {String|Number}
         @return {esc.Criteria} This criteria
         **&#x2F;
        addPredicate : function (join, value) {
            var criteria = this.criteria;

            if (criteria instanceof Criteria) {
                throw &quot;Can&#x27;t add predicate to Criteria instance.&quot;;
            }

            criteria.value = value;
            criteria.join = join;

            return this;
        },

        &#x2F;**
         @method like
         @chainable
         @param value {String|Number}
         @return {esc.Criteria} This criteria
         **&#x2F;
        like : function (value) {
            value = value.replace(&#x2F;(\&#x27;)&#x2F;g, &#x27;\\$1&#x27;);

            return this.addPredicate(&#x27;LIKE&#x27;, &quot;&#x27;&quot; + value + &quot;&#x27; ESCAPE &#x27;\\&#x27;&quot;);
        },

        &#x2F;**
         @method is
         @chainable
         @param value {String|Number}
         @return {esc.Criteria} This criteria
         **&#x2F;
        is : function (value) {
            return this.addPredicate(&#x27;==&#x27;, value);
        },

        &#x2F;**
         @method gt
         @chainable
         @param value {String|Number}
         @return {esc.Criteria} This criteria
         *&#x2F;
        gt : function (value) {
            return this.addPredicate(&#x27;&gt;&#x27;, value);
        },

        &#x2F;**
         @method lt
         @chainable
         @param value {String|Number}
         @return {esc.Criteria} This criteria
         **&#x2F;
        lt : function (value) {
            return this.addPredicate(&#x27;&lt;&#x27;, value);
        },

        orderBy : function () {
            var sel = this.select();
            return sel.orderBy.apply(sel, arguments);
        },
        limit   : function () {
            var sel = this.select();
            return sel.limit.apply(sel, arguments);
        },

        &#x2F;**
         Evaluates the current select statement.

         @method exec
         @param a {Object|Number|Array|String}
         @return {String}
         **&#x2F;
        exec : function (a, force) {
            var criteria = this.criteria,
                sel,
                out;

            if (force) {
                if (criteria instanceof Criteria) {
                    out = [ &#x27;(&#x27;, criteria.exec(a, true), &#x27;)&#x27; ].join(&#x27; &#x27;);
                } else if (typeof criteria === &#x27;function&#x27;) {
                    out = criteria.call(this, a);
                } else {
                    out = [ criteria.column, criteria.join, Y.Lang.sub(criteria.value, a) ].join(&#x27; &#x27;);
                }

                if (this.child) {
                    out = [ out, this.child.join, this.child.criteria.exec(a, true) ].join(&#x27; &#x27;);
                }

            } else {
                sel = this.select();
                out = sel.exec.apply(sel, arguments);
            }

            return out;
        }
    });

    NS.Criteria = Criteria;

    &#x2F;**
     Generates a new select statement that can be evaluated using &#x60;exec&#x60;. Generally accessed via the &#x60;from&#x60; factory method.

     @class Select
     @constructor
     @param tablesAndFields {Object}

     @example

         select.from({ &#x27;invTypes&#x27;: [ &#x27;typeID&#x27;, &#x27;typeName&#x27; ] }).where(&#x27;typeID&#x27;).is(&#x27;{id}&#x27;).exec({ id: 12345 });
         &#x2F;&#x2F; SELECT invTypes.typeID, invTypes.typeName FROM invTypes WHERE typeID == 12345

     **&#x2F;
    function Select(tablesAndFields) {
        var table, fields, field, i, l;

        this.tables = {};
        this.fields = {};
        this.order  = [];

        for (table in tablesAndFields) {
            if (tablesAndFields.hasOwnProperty(table)) {
                fields = tablesAndFields[table];

                this.tables[table] = true;

                if ((&#x2F;\s+AS\s+&#x2F;).test(table)) {
                    table = (&#x2F;\s+AS\s+([\w\W]+)&#x2F;).exec(table)[1];
                }

                for (i = 0, l = fields.length; i &lt; l; i += 1) {
                    field = fields[i];

                    this.fields[table + &#x27;.&#x27; + field] = true;
                }
            }
        }

        this.tables = Object.keys(this.tables);
        this.fields = Object.keys(this.fields);
    }

    &#x2F;**
     A factory method for Select

     @method from
     @static
     @param tablesAndFields {Object}
     @return {esc.Select} A new select instance.
     **&#x2F;
    Select.from = function (tablesAndFields) {
        return new Select(tablesAndFields);
    };

    Y.mix(Select.prototype, {
        tables   : null,
        fields   : null,
        criteria : null,
        order    : null,

        &#x2F;**
         Returns a new Criteria clause attached to this select statement.

         @method where
         @param columnOrCriteria {String|Function|esc.Criteria}
         @return {esc.Criteria} The first item on the criteria chain.
         **&#x2F;
        where : function (columnOrCriteria) {
            var c = new Criteria(columnOrCriteria, null, this);

            this.criteria = c;
            return c;
        },

        limit : function () {
            return this;
        },

        orderBy : function (field, sort) {
            sort = sort || &#x27;ASC&#x27;;
            this.order.push({ field: field, sort: sort });

            return this;
        },

        &#x2F;**
         A factory method for Select

         @method exec
         @param a {String|Number|Array|Object}
         @return {String} The evaluated select statement.
         **&#x2F;
        exec : function (a) {
            var orderStack,
                sel = [
                    &#x27;SELECT&#x27;, this.fields.join(&#x27;, &#x27;),
                    &#x27;FROM&#x27;, this.tables.join(&#x27;, &#x27;)
                ];

            if (this.criteria) {
                sel.push(&#x27;WHERE&#x27;);
                sel.push(this.criteria.exec(a, true));
            }

            if (this.order.length) {
                sel.push(&#x27;ORDER BY&#x27;);
                orderStack = [];

                this.order.forEach(function(o) {
                    orderStack.push(o.field + &#x27; &#x27; + o.sort);
                });
                sel.push(orderStack.join(&#x27;, &#x27;));
            }

            return sel.join(&#x27; &#x27;);
        }
    });

    NS.Select = Select;

}, &#x27;&#x27;, {});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
